## 路由器(Router)中如何实现端口映射
一般路由器中有个端口映射（PortMapping）或者虚拟服务器(VirtualServer)的设置。用户需要在路由器(Router)的“管理界面”中相应的端口映射界面中,设置好相应的需要映射的端口,协议,内网地址等,才能生效。设置的方法可能会因为路由器(Router)不同的品牌和型号，在设置的方法上也会有所不同。端口映射支持的网络协议有TCP/UDP/两者, 所以进行端口映射设置时, 如果不熟悉, 可以选择两者都支持。
举例说明:
这里假定路由器(Router)默认IP内网地址为192.168.1.1，内网中电脑一般可以设置成为192.168.1.X（X=2~254），在内网中某一台电脑上打开IE，在地址栏输入http://192.168.1.1，输入初始用户名、密码，之后就可以看到设置界面了。
针对邮件服务器要做如下设置：进入“端口映射”，在端口填入 25, 协议中选择： TCP, IP地址： 192.168.1.x(x 为安装邮件服务器电脑的局域网IP 地址），同样方法设置110(pop3),6080(webmail)端口等。 以上假定用户内网段地址为:192.168.1.0。设置好后, 就实现了端口映射功能了, 发往路由器的邮件就会自动转发到指定的内网主机上(192.168.1.x)。
同样, 如果想设置特殊端口, 比如: 6000。 在端口填入 6000, 协议中选择： ALL(或根据具体情况选择), IP 地址：192.168.1.x(x 为内网段地址1~254)。 设置好后, 发往路由器6000 端口的任何数据就会自动转发到主机192.168.1.x 的端口6000 上了。

## NAT（Network Address Translation）
### 分类
NAT的实现方式有三种，即静态转换Static Nat、动态转换Dynamic Nat和端口多路复用OverLoad。

静态转换是指将内部网络的私有IP地址转换为公有IP地址，IP地址对是一对一的，是一成不变的，某个私有IP地址只转换为某个公有IP地址。借助于静态转换，可以实现外部网络对内部网络中某些特定设备（如服务器）的访问。

动态转换是指将内部网络的私有IP地址转换为公用IP地址时，IP地址是不确定的，是随机的，所有被授权访问上Internet的私有IP地址可随机转换为任何指定的合法IP地址。也就是说，只要指定哪些内部地址可以进行转换，以及用哪些合法地址作为外部地址时，就可以进行动态转换。动态转换可以使用多个合法外部地址集。当ISP提供的合法IP地址略少于网络内部的计算机数量时。可以采用动态转换的方式。

端口多路复用（Port address Translation,PAT)是指改变外出数据包的源端口并进行端口转换，即端口地址转换（PAT，Port Address Translation).采用端口多路复用方式。内部网络的所有主机均可共享一个合法外部IP地址实现对Internet的访问，从而可以最大限度地节约IP地址资源。同时，又可隐藏网络内部的所有主机，有效避免来自internet的攻击。因此，目前网络中应用最多的就是端口多路复用方式。
PAT（Port Address Translation）方式的地址转换利用了TCP/UDP协议的端口号，进行地址转换；
PAT方式的地址转换是采用了“地址＋端口”的映射方式，因此可以使内部局域网的许多主机共享一个IP地址访问Internet；PAT也叫动态地址转换，在私有网络地址和外部网络地址之间建立多对一映射，达到了内部网多台主机共用同一个公网地址访问外部网络的目的，所以在实际应用中多数采用这种方式；

### 三者对比解析
NAT(静态，动态)方式指在出方向上转换IP报文头中的源IP地址，而不对端口进行转换；
NAT（静态，动态）方式下私有网络地址和外部网络地址之间建立一对一映射；
NAT方式 不能达到内部网多台主机共用同一个公网地址访问外部网络的目的，所以在实际应用中很少采用这种方式；
而由于内外网地址一一对应，实现比较简单，只转换IP 报文头中的IP地址，所以适用于所有IP报文转换
PAT方式下不同的内部网地址，转换时采用相同的公网地址，并依靠不同的端口号来区分每一个内部网主机；PAT方式的地址转换使用了TCP/UDP的端口信息，这样在进行地址转换的时候使用的是“地址＋端口”来区分内部局域网的主机对外发起的不同连接。这样使用地址转换，内部局域网的用户可以共享一个IP地址上网了。在使用PAT方式的地址转换时，即转换了数据包中的 源地址也转换了数据包中的端口信息。
显然可以看出，PAT方式的地址转换只能适用在TCP/UDP协议中，一般称只转换地址方式的地址转换为“简单的地址转换”；PAT方式需要转换IP地址和端口信息，所以只使用于TCP/UDP报文的转换。